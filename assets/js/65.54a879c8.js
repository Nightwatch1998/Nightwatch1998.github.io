(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{349:function(t,a,s){"use strict";s.r(a);var n=s(10),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"springboot数据库连接池"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot数据库连接池"}},[t._v("#")]),t._v(" Springboot数据库连接池")]),t._v(" "),a("h2",{attrs:{id:"连接池"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接池"}},[t._v("#")]),t._v(" 连接池")]),t._v(" "),a("h3",{attrs:{id:"常见连接池"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见连接池"}},[t._v("#")]),t._v(" 常见连接池")]),t._v(" "),a("p",[t._v("C3P0：是Hibernate内置的数据库连接池，官方已经不再维护")]),t._v(" "),a("p",[t._v("DBCP：内部依赖Commons-Pool,性能差，现在已经放弃维护")]),t._v(" "),a("p",[t._v("hikariCP：轻量级，高性能的连接池，快速启动，易于配置和使用")]),t._v(" "),a("p",[t._v("Druid:功能最为全面，sql拦截，统计数据较为全面，具有良好扩展性")]),t._v(" "),a("h3",{attrs:{id:"hharicp使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hharicp使用"}},[t._v("#")]),t._v(" HhariCP使用")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hikari")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#连接池名")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pool-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HikariCP\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最小空闲连接数")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minimum-idle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 空闲连接存活最大时间，默认10分钟")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("idle-timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("600000")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接池最大连接数，默认是10")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maximum-pool-size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此属性控制从池返回的连接的默认自动提交行为,默认值：true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("auto-commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此属性控制池中连接的最长生命周期，值0表示无限生命周期，默认30分钟")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-lifetime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1800000")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据库连接超时时间,默认30秒")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connection-timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接测试query")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connection-test-query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SELECT 1\n")])])]),a("h3",{attrs:{id:"druid使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#druid使用"}},[t._v("#")]),t._v(" Druid使用")]),t._v(" "),a("p",[t._v("Druid是阿里巴巴的数据库连接池项目，为监控而生，监控特性不影响性能。功能强大，能防止SQL注入。")]),t._v(" "),a("p",[t._v("内置了监控页面，提供了非常完备的监控信息。")]),t._v(" "),a("h4",{attrs:{id:"statfilter介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#statfilter介绍"}},[t._v("#")]),t._v(" StatFilter介绍")]),t._v(" "),a("p",[t._v("Druid监控信息通过StatFilter采集，包括SQL执行，并发，慢查，执行区间分布等")]),t._v(" "),a("p",[t._v("特点：")]),t._v(" "),a("ul",[a("li",[t._v("监控不影响性能，占用内存和CPU极小")]),t._v(" "),a("li",[t._v("SQL参数化合并监控")]),t._v(" "),a("li",[t._v("执行次数、返回行数、更新行数和并发监控")]),t._v(" "),a("li",[t._v("慢查监控：超过3s被认为是慢查")]),t._v(" "),a("li",[t._v("Exception监控")]),t._v(" "),a("li",[t._v("诊断支持：内置了LogFilter")]),t._v(" "),a("li",[t._v("防止SQL注入\n"),a("ul",[a("li",[t._v("基于语义的防SQL注入")]),t._v(" "),a("li",[t._v("极低的漏报率和误报率")]),t._v(" "),a("li",[t._v("防注入对性能影响极小")])])])]),t._v(" "),a("h4",{attrs:{id:"引入依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入依赖"}},[t._v("#")]),t._v(" 引入依赖")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.alibaba"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("druid-spring-boot-starter"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("1.2.9"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h4",{attrs:{id:"yml配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#yml配置"}},[t._v("#")]),t._v(" yml配置")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Druid datasource")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" com.alibaba.druid.pool.DruidDataSource\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("druid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 初始化大小")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initial-size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最小连接数")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-idle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最大连接数")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-active")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取连接时的最大等待时间")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-wait")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 一个连接在池中最小生存的时间，单位是毫秒")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-evictable-idle-time-millis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300000")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 多久才进行一次检测需要关闭的空闲连接，单位是毫秒")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("time-between-eviction-runs-millis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置扩展插件：stat-监控统计，log4j-日志，wall-防火墙（防止SQL注入），去掉后，监控界面的sql无法统计")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("wall\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检测连接是否有效的 SQL语句，为空时以下三个配置均无效")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("validation-query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SELECT 1\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 申请连接时执行validationQuery检测连接是否有效，默认true，开启后会降低性能")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test-on-borrow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 归还连接时执行validationQuery检测连接是否有效，默认false，开启后会降低性能")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test-on-return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 申请连接时如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效，默认false，建议开启，不影响性能")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test-while-idle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启 StatViewServlet")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stat-view-servlet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问监控页面 白名单，默认127.0.0.1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("login-username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("login-password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# FilterStat")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启 FilterStat，默认true")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启 慢SQL 记录，默认false,SQL执行时间超过阈值被打印")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("log-slow-sql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 慢 SQL 的标准，默认 3000，单位：毫秒")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slow-sql-millis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 合并多个连接池的监控数据，默认false")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("merge-sql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n")])])]),a("h4",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),a("p",[t._v("访问http://localhost:8080/druid/datasource.html")]),t._v(" "),a("p",[t._v("admin/admin登录")])])}),[],!1,null,null,null);a.default=e.exports}}]);