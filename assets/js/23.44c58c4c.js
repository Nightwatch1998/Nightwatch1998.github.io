(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{307:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"dockerfile的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile的使用"}},[t._v("#")]),t._v(" DockerFile的使用")]),t._v(" "),s("h2",{attrs:{id:"dockerfile介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile介绍"}},[t._v("#")]),t._v(" DockerFile介绍")]),t._v(" "),s("p",[t._v("dockerfile是用来构建docker镜像的文件！")]),t._v(" "),s("p",[t._v("构建步骤：")]),t._v(" "),s("p",[t._v("1、编写一个dockerfile文件")]),t._v(" "),s("p",[t._v("2、docker build构建成为一个镜像")]),t._v(" "),s("p",[t._v("3、docker run 运行镜像")]),t._v(" "),s("p",[t._v("4、docker push 发布镜像（Docker Hub、阿里云镜像仓库）")]),t._v(" "),s("h2",{attrs:{id:"dockerfile构建过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile构建过程"}},[t._v("#")]),t._v(" DockerFile构建过程")]),t._v(" "),s("p",[t._v("基础知识：")]),t._v(" "),s("p",[t._v("1、每个保留关键字都必须是大写字母")]),t._v(" "),s("p",[t._v("2、执行从上到下顺序执行")]),t._v(" "),s("p",[t._v("3、#表示注释")]),t._v(" "),s("p",[t._v("4、每个指令都会创建提交一个新的镜像层，并提交")]),t._v(" "),s("h2",{attrs:{id:"dockerfile的指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile的指令"}},[t._v("#")]),t._v(" DockerFile的指令")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("FROM         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定基础镜像，比如node:8")]),t._v("\nMAINTAINER   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像作者，姓名+邮箱")]),t._v("\nRUN\t\t\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建镜像时运行的shell命令")]),t._v("\nADD          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加文件到镜像中，和COPY的区别是可以自动解压")]),t._v("\nWORKDIR      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置工作目录")]),t._v("\nVOLUME       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定挂载点到宿主机目录")]),t._v("\nEXPOSE       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生命容器使用的网络端口")]),t._v("\nCMD          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动容器时运行的shell命令，只有最后一个会生效,运行容器的指定命令会替代CMD")]),t._v("\nENTRYPOINT   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动容器时运行的shell命令，运行容器时指定的命令会追加")]),t._v("\nONBUILD      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当构建一个被继承DockerFile 时运行")]),t._v("\nCOPY         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 类似ADD，将文件拷贝到镜像环境")]),t._v("\nENV          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建的时候设置环境变量")]),t._v("\n")])])]),s("h2",{attrs:{id:"创建自定义dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建自定义dockerfile"}},[t._v("#")]),t._v(" 创建自定义DockerFile")]),t._v(" "),s("h3",{attrs:{id:"实战-添加vim命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战-添加vim命令"}},[t._v("#")]),t._v(" 实战：添加vim命令")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1 编写Dockerfile文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat mydockerfile")]),t._v("\nFROM centos\nMAINTAINER huyadish"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("gh123456@163.com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\nENV MYPATH /usr/local\nWORKDIR "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MYPATH")]),t._v("\n\nRUN yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\nRUN yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" net-tools\n\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n\nCMD "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MYPATH")]),t._v("\nCMD "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"---end---"')]),t._v("\nCMD /bin/bash\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2 通过这个文件构建镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker build -f mydockerfile -t mycentos:1.0 .")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3 测试运行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run -it mycentos:1.0 /bin/bash")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4 查看镜像是如何生成的")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("history")]),t._v(" 镜像名\n")])])]),s("p",[t._v("遇到的坑：yum 安装失败，无法解析mirrorlist.centos.org")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n => ERROR [3/4] RUN yum -y install vim                                                                    0.8s\n------\n > [3/4] RUN yum -y install vim:\n0.716 CentOS Linux 8 - AppStream                      0.0  B/s |   0  B     00:00\n0.717 Errors during downloading metadata for repository 'appstream':\n0.717   - Curl error (6): Couldn't resolve host name for http://mirrorlist.centos.org/?release=8&arch=x86_64&repo=AppStream&infra=container [Could not resolve host: mirrorlist.centos.org]\n\n")])])]),s("blockquote",[s("p",[t._v("注意：centos7已经在2024年6月30日停止维护，相关的镜像网站也停了")])]),t._v(" "),s("p",[t._v("在dockerfile中添加换源信息")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("FROM centos\nMAINTAINER huyadish"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("gh123456@163.com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\nENV MYPATH /usr/local\nWORKDIR "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MYPATH")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 换为阿里云的镜像源")]),t._v("\nRUN "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /etc/yum.repos.d/\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/mirrorlist/#mirrorlist/g'")]),t._v(" /etc/yum.repos.d/CentOS-*\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s|#baseurl=http://mirror.centos.org|baseurl=http://mirrors.aliyun.com|g'")]),t._v(" /etc/yum.repos.d/CentOS-*\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 vim  net-tools")]),t._v("\nRUN yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\nRUN yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" net-tools\n\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n\nCMD /bin/bash\n")])])]),s("p",[t._v("构建运行")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker build -f Dockerfile1 -t test .")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Building "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(".0s "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v("/11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" FINISHED \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行并进入")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run -it test /bin/bash")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@d85874588b4a local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 测试")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@d85874588b4a local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim --help")]),t._v("\nVIM - Vi IMproved "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),t._v(" Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(", compiled Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(":10:49"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@d85874588b4a local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ifconfig")]),t._v("\neth0: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("flags")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("416")]),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("3")]),t._v("<")]),t._v("UP,BROADCAST,RUNNING,MULTICAST"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  mtu "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1500")]),t._v("\n        inet "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2  netmask "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255.255")]),t._v(".0.0  broadcast "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".255.255\n        ether 02:42:ac:11:00:02  txqueuelen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ethernet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        RX packets "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("  bytes "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("656")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("656.0")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        RX errors "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  dropped "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  overruns "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  frame "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n        TX packets "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  bytes "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        TX errors "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  dropped "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" overruns "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  carrier "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  collisions "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\nlo: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("flags")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("3")]),t._v("<")]),t._v("UP,LOOPBACK,RUNNING"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  mtu "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65536")]),t._v("\n        inet "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1  netmask "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255.0")]),t._v(".0.0\n        inet6 ::1  prefixlen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),t._v("  scopeid 0x1"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v("<")]),t._v("host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        loop  txqueuelen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Local Loopback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        RX packets "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  bytes "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        RX errors "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  dropped "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  overruns "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  frame "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n        TX packets "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  bytes "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        TX errors "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  dropped "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" overruns "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  carrier "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  collisions "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("h3",{attrs:{id:"实战-cmd-和-entrypoint的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战-cmd-和-entrypoint的区别"}},[t._v("#")]),t._v(" 实战：CMD 和 ENTRYPOINT的区别")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("CMD          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动容器时运行的shell命令，只有最后一个会生效,运行容器的指定命令会替代CMD")]),t._v("\nENTRYPOINT   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动容器时运行的shell命令，运行容器时指定的命令会追加")]),t._v("\n")])])]),s("p",[t._v("测试CMD")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建dockerfile")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim mydockerfile-test")]),t._v("\nFROM centos\nCMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ls"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-a"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker build -f mydockerfile-test -t cmdtest .")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run -it cmdtest")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("   .dockerenv  dev  home  lib64       media  opt   root  sbin  sys  usr\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("  bin         etc  lib   lost+found  mnt    proc  run   srv   tmp  var\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 追加一个命令 -l 期望 ls -al  然而报错")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run cmdtest -l")]),t._v("\ndocker: Error response from daemon: failed to create task "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-l"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" executable "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" not found "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" unknown.\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# cmd的情况下 -l 替换了 CMD ["ls","-a"] 命令，然而 -l 并不是个命令，所以报错')]),t._v("\n")])])]),s("p",[t._v("测试ENTRYPOINT")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建dockerfile")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim mydockerfile-entrypoint")]),t._v("\nFROM centos\nENTRYPOINT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ls"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-a"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker build -f mydockerfile-entrypoint -t myentrypoint .")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run myentrypoint")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n.dockerenv\nbin\ndev\netc\nhome\nlib\nlib64\nlost+found\nmedia\nmnt\nopt\nproc\nroot\nrun\nsbin\nsrv\nsys\ntmp\nusr\nvar\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加参数运行 -l 相当于运行 ls -al")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run myentrypoint -l")]),t._v("\ntotal "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v("\ndrwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":30 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\ndrwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":30 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n-rwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":30 .dockerenv\nlrwxrwxrwx   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" bin -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" usr/bin\ndrwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" root root  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("340")]),t._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":30 dev\ndrwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":30 etc\ndrwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" home\nlrwxrwxrwx   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" lib -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" usr/lib\nlrwxrwxrwx   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" lib64 -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" usr/lib64\ndrwx------   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" lost+found\ndrwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" media\ndrwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" mnt\ndrwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" opt\ndr-xr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("125")]),t._v(" root root    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":30 proc\ndr-xr-x---   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" root\ndrwxr-xr-x  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" run\nlrwxrwxrwx   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" sbin -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" usr/sbin\ndrwxr-xr-x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" srv\ndr-xr-xr-x  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(" root root    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":04 sys\ndrwxrwxrwt   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" tmp\ndrwxr-xr-x  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" usr\ndrwxr-xr-x  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" var\n")])])]),s("h3",{attrs:{id:"实战-tomcat镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战-tomcat镜像"}},[t._v("#")]),t._v(" 实战：Tomcat镜像")]),t._v(" "),s("p",[t._v("1、准备镜像文件 tomcat 压缩包，jdk压缩包")]),t._v(" "),s("p",[t._v("2、编写dockerfile文件,官方推荐命名Dockerfile")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("FROM centos\nMAINTAINER huyadish"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("huyadish@163.com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\nCOPY README.md /usr/local/README.md\n\nADD jdk-8u161-linux-x64.tar.gz /usr/local\nADD apache-tomcat-8.5.55.tar.gz /usr/local\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RUN yum -y install vim")]),t._v("\n\nENV MYPATH /usr/local\nWORKDIR "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MYPATH")]),t._v("\n\nENV JAVA_HOME /usr/local/jdk1.8.0_161\nENV CLASSPATH "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/lib/dt.jar:"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/lib/tools.jar\nENV CATALINA_HOME /usr/local/apache-tomcat-8.5.55\nENV CATALINA_BASE /usr/local/apache-tomcat-8.5.55\nENV "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/bin:"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CATALINA_HOME")]),t._v("/lib:"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CATALINA_HOME")]),t._v("/bin\n\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n\nCMD  /usr/local/apache-tomcat-8.5.55/bin/startup.sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-F")]),t._v(" /usr/local/apache-tomcat-8.5.55/bin/logs/catalin\na.out\n")])])]),s("p",[t._v("3、构建镜像")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker build -t mytomcat .   ")]),t._v("\n")])])]),s("p",[t._v("4、运行镜像")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行并挂载数据卷")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run -d -p 9090:8080 --name huyadish-tomcat -v /home/huyadish/build/tomcat/test/:/usr/local/apache-tomcat-8.5.55/webapps/test -v /home/huyadish/build/tomcat/logs/:/usr/local/apache-tomcat-8.5.55/logs mytomcat")]),t._v("\n31a90f439ab5aad6c99e37cb4803b54bb4e31608f0cf818b99e2c957570781fe\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos dockerfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker exec -it 31a90f4 /bin/bash")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以看到已经解压的 tomcat 和 jdk")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@31a90f439ab5 local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\nREADME.md  apache-tomcat-8.5.55  bin  etc  games  include  jdk1.8.0_161  lib  lib64  libexec  sbin  share  src\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工作目录也切换到了 /usr/local")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@31a90f439ab5 local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pwd")]),t._v("\n/usr/local\n\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@31a90f439ab5 local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd apache-tomcat-8.5.55/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@31a90f439ab5 apache-tomcat-8.5.55"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\nBUILDING.txt     LICENSE  README.md      RUNNING.txt  conf  logs  webapps\nCONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin          lib   temp  work\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此时通过外网也可以访问")]),t._v("\n")])])]),s("p",[t._v("5、发布项目（由于做了卷挂载，我们直接在本地编写项目就可以）")]),t._v(" "),s("ul",[s("li",[t._v("web.xml")])]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("web-app")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("xsi")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.w3.org/2001/XMLSchema-instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" \n "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("xmlns")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://java.sun.com/xml/ns/javaee"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xsi:")]),t._v("schemaLocation")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://java.sun.com/xml/ns/javaee \nhttp://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("WebApp_ID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("display-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("test"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("display-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("web-app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("ul",[s("li",[t._v("a.jsp")])]),t._v(" "),s("div",{staticClass:"language-jsp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('<%@ page language="java" contentType="text/html; charset=UTF-8" \npageEncoding="UTF-8"%>\n<!DOCTYPE html>\n<html> \n <head>\n   <meta charset="utf-8"> \n   <title>hello，huyadish</title>\n </head> \n <body>\n\thello,world!<br>\n   <% System.out.println("-------my docker tomcat-------");%> \n </body>\n</html>\n')])])]),s("h2",{attrs:{id:"发布镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布镜像"}},[t._v("#")]),t._v(" 发布镜像")]),t._v(" "),s("h3",{attrs:{id:"发布到docker-hub"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布到docker-hub"}},[t._v("#")]),t._v(" 发布到docker hub")]),t._v(" "),s("p",[t._v("在https://hub.docker.com/注册自己的账号")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 首先登录docker hub")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker login --help")]),t._v("\nUsage:  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" login "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("SERVER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nLog "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" to a registry.\nIf no server is specified, the default is defined by the daemon.\n\nOptions:\n  -p, "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--password")]),t._v(" string   Password\n      --password-stdin    Take the password from stdin\n  -u, "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--username")]),t._v(" string   Username\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker login -u olgstag")]),t._v("\nPassword: "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输入密码")]),t._v("\nLogin Succeeded\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 直接push会失败")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker push mytomcat")]),t._v("\nUsing default tag: latest\nThe push refers to repository "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("docker.io/library/mytomcat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n5f70bf18a086: Preparing\n8d76854d13f0: Preparing\n60424f91fa9b: Preparing\n87a7a415f2e5: Preparing\n74ddd0ec08fa: Preparing\ndenied: requested access to the resource is denied\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用docker tag 为已有镜像创建一个标签， 并添加远程仓库名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker tag test olgstag/test:1.0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新push  网络问题 连接失败")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker push olgstag/test:1.0")]),t._v("\n")])])]),s("h3",{attrs:{id:"发布到阿里云docker镜像服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布到阿里云docker镜像服务"}},[t._v("#")]),t._v(" 发布到阿里云docker镜像服务")]),t._v(" "),s("p",[t._v("1、登录阿里云")]),t._v(" "),s("p",[t._v("2、找到容器镜像服务")]),t._v(" "),s("p",[t._v("3、创建命名空间")]),t._v(" "),s("p",[t._v("4、创建仓库")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 登录阿里云远程仓库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker login --username=oldstag registry.cn-hangzhou.aliyuncs.com")]),t._v("\nPassword:\nWARNING"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Your password will be stored unencrypted "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#credentials-store")]),t._v("\n\nLogin Succeeded\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为本地镜像添加tag")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker tag test registry.cn-hangzhou.aliyuncs.com/oldstag/docker-test:1.0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推送到阿里云容器仓库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-20-7-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker push registry.cn-hangzhou.aliyuncs.com/oldstag/docker-test:1.0")]),t._v("\nThe push refers to repository "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("registry.cn-hangzhou.aliyuncs.com/oldstag/docker-test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n02102190b029: Pushed\nfd99157a0f6b: Pushed\n89e8e6aeee7a: Pushed\n3f25450bae38: Pushed\n5f70bf18a086: Pushed\n74ddd0ec08fa: Pushed\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v(": digest: sha256:c5c513ed607b3cd5a47c97979c41a82db99d16084e38cfcdcb2cbad576af91fd size: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1780")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推送成功")]),t._v("\n")])])]),s("p",[t._v("使用阿里云的镜像服务需要配置一下 阿里云的镜像加速")]),t._v(" "),s("h2",{attrs:{id:"小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://stag-blog.oss-cn-beijing.aliyuncs.com/picture/docker%E6%93%8D%E4%BD%9C%E5%85%A8%E6%B5%81%E7%A8%8B.png",alt:"Docker全流程"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);