<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ShardingSphere分库分表 | NightWatch</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/favicon.png">
    <meta name="description" content="编程，从入门到入土">
    
    <link rel="preload" href="/assets/css/0.styles.4c261fea.css" as="style"><link rel="preload" href="/assets/js/app.1522ec5c.js" as="script"><link rel="preload" href="/assets/js/2.4829a41e.js" as="script"><link rel="preload" href="/assets/js/1.21e39df5.js" as="script"><link rel="preload" href="/assets/js/57.7d9e50ac.js" as="script"><link rel="prefetch" href="/assets/js/10.36ab4607.js"><link rel="prefetch" href="/assets/js/100.e7ac6025.js"><link rel="prefetch" href="/assets/js/101.49458bca.js"><link rel="prefetch" href="/assets/js/102.2ef656b6.js"><link rel="prefetch" href="/assets/js/103.9f9dd0d9.js"><link rel="prefetch" href="/assets/js/104.e81c68c6.js"><link rel="prefetch" href="/assets/js/105.d0980382.js"><link rel="prefetch" href="/assets/js/106.27857477.js"><link rel="prefetch" href="/assets/js/107.5692a1f8.js"><link rel="prefetch" href="/assets/js/108.f40d04f9.js"><link rel="prefetch" href="/assets/js/109.3d772ced.js"><link rel="prefetch" href="/assets/js/11.9d26e9af.js"><link rel="prefetch" href="/assets/js/110.409e3dd2.js"><link rel="prefetch" href="/assets/js/111.85035d5d.js"><link rel="prefetch" href="/assets/js/112.bc27d086.js"><link rel="prefetch" href="/assets/js/113.add5f30b.js"><link rel="prefetch" href="/assets/js/114.b07991f7.js"><link rel="prefetch" href="/assets/js/115.bdf23499.js"><link rel="prefetch" href="/assets/js/116.f8d6ac89.js"><link rel="prefetch" href="/assets/js/117.06b81121.js"><link rel="prefetch" href="/assets/js/118.7eb8683b.js"><link rel="prefetch" href="/assets/js/119.d06b800f.js"><link rel="prefetch" href="/assets/js/12.0b61f8e9.js"><link rel="prefetch" href="/assets/js/120.91c90e3c.js"><link rel="prefetch" href="/assets/js/121.710a9017.js"><link rel="prefetch" href="/assets/js/122.0bf930a6.js"><link rel="prefetch" href="/assets/js/123.051af2ee.js"><link rel="prefetch" href="/assets/js/124.5ddc14ba.js"><link rel="prefetch" href="/assets/js/125.047274a6.js"><link rel="prefetch" href="/assets/js/126.cbda4167.js"><link rel="prefetch" href="/assets/js/127.f4fb4ba8.js"><link rel="prefetch" href="/assets/js/128.b129f306.js"><link rel="prefetch" href="/assets/js/129.e896cb33.js"><link rel="prefetch" href="/assets/js/13.152b21ae.js"><link rel="prefetch" href="/assets/js/130.136aa3a1.js"><link rel="prefetch" href="/assets/js/131.f19cb8d9.js"><link rel="prefetch" href="/assets/js/132.f5a689b3.js"><link rel="prefetch" href="/assets/js/133.37e12b0e.js"><link rel="prefetch" href="/assets/js/134.71d4d90d.js"><link rel="prefetch" href="/assets/js/135.62dc2482.js"><link rel="prefetch" href="/assets/js/136.3c305820.js"><link rel="prefetch" href="/assets/js/137.a283a18c.js"><link rel="prefetch" href="/assets/js/138.d72194c8.js"><link rel="prefetch" href="/assets/js/139.bf608557.js"><link rel="prefetch" href="/assets/js/14.601864c0.js"><link rel="prefetch" href="/assets/js/140.fc9c3ff2.js"><link rel="prefetch" href="/assets/js/141.c083c71c.js"><link rel="prefetch" href="/assets/js/142.b66bd635.js"><link rel="prefetch" href="/assets/js/143.e2a188e1.js"><link rel="prefetch" href="/assets/js/144.636a1d54.js"><link rel="prefetch" href="/assets/js/145.6f07a066.js"><link rel="prefetch" href="/assets/js/146.571d3df9.js"><link rel="prefetch" href="/assets/js/15.1ca2d588.js"><link rel="prefetch" href="/assets/js/16.f4f9fc10.js"><link rel="prefetch" href="/assets/js/17.c0c7e874.js"><link rel="prefetch" href="/assets/js/18.1dcc6d96.js"><link rel="prefetch" href="/assets/js/19.eb1d2ccc.js"><link rel="prefetch" href="/assets/js/20.e0b38ec4.js"><link rel="prefetch" href="/assets/js/21.78e23c64.js"><link rel="prefetch" href="/assets/js/22.2aa7a141.js"><link rel="prefetch" href="/assets/js/23.44c58c4c.js"><link rel="prefetch" href="/assets/js/24.0840f4e5.js"><link rel="prefetch" href="/assets/js/25.58e5e2bb.js"><link rel="prefetch" href="/assets/js/26.117af3de.js"><link rel="prefetch" href="/assets/js/27.21f17c05.js"><link rel="prefetch" href="/assets/js/28.c1a21400.js"><link rel="prefetch" href="/assets/js/29.73cf9cfe.js"><link rel="prefetch" href="/assets/js/3.ce969d4f.js"><link rel="prefetch" href="/assets/js/30.c86f3824.js"><link rel="prefetch" href="/assets/js/31.38937e5c.js"><link rel="prefetch" href="/assets/js/32.069c2b00.js"><link rel="prefetch" href="/assets/js/33.616d554f.js"><link rel="prefetch" href="/assets/js/34.7bef359c.js"><link rel="prefetch" href="/assets/js/35.2a1b0457.js"><link rel="prefetch" href="/assets/js/36.90856356.js"><link rel="prefetch" href="/assets/js/37.7687598f.js"><link rel="prefetch" href="/assets/js/38.3eeb72db.js"><link rel="prefetch" href="/assets/js/39.0f9a99db.js"><link rel="prefetch" href="/assets/js/4.b8125ad6.js"><link rel="prefetch" href="/assets/js/40.3d6cc708.js"><link rel="prefetch" href="/assets/js/41.17ac3941.js"><link rel="prefetch" href="/assets/js/42.d993a8f7.js"><link rel="prefetch" href="/assets/js/43.17017893.js"><link rel="prefetch" href="/assets/js/44.ad292c75.js"><link rel="prefetch" href="/assets/js/45.f96b17d1.js"><link rel="prefetch" href="/assets/js/46.c772afe8.js"><link rel="prefetch" href="/assets/js/47.ac4c7dc5.js"><link rel="prefetch" href="/assets/js/48.35994a43.js"><link rel="prefetch" href="/assets/js/49.345a6aed.js"><link rel="prefetch" href="/assets/js/5.2d50631a.js"><link rel="prefetch" href="/assets/js/50.8ea6eace.js"><link rel="prefetch" href="/assets/js/51.a26f2640.js"><link rel="prefetch" href="/assets/js/52.58d1f5a0.js"><link rel="prefetch" href="/assets/js/53.fc8989a8.js"><link rel="prefetch" href="/assets/js/54.24b38690.js"><link rel="prefetch" href="/assets/js/55.bbdb58ff.js"><link rel="prefetch" href="/assets/js/56.82b35717.js"><link rel="prefetch" href="/assets/js/58.462768e2.js"><link rel="prefetch" href="/assets/js/59.e982a60f.js"><link rel="prefetch" href="/assets/js/6.674e2ad9.js"><link rel="prefetch" href="/assets/js/60.0c8222f2.js"><link rel="prefetch" href="/assets/js/61.9df80c8b.js"><link rel="prefetch" href="/assets/js/62.dceacd47.js"><link rel="prefetch" href="/assets/js/63.78ff92d6.js"><link rel="prefetch" href="/assets/js/64.5949a53c.js"><link rel="prefetch" href="/assets/js/65.e755be5a.js"><link rel="prefetch" href="/assets/js/66.e233a214.js"><link rel="prefetch" href="/assets/js/67.b078d912.js"><link rel="prefetch" href="/assets/js/68.f731dd82.js"><link rel="prefetch" href="/assets/js/69.1d8a803b.js"><link rel="prefetch" href="/assets/js/7.f1dd9a86.js"><link rel="prefetch" href="/assets/js/70.716dd210.js"><link rel="prefetch" href="/assets/js/71.fd248748.js"><link rel="prefetch" href="/assets/js/72.6be0724a.js"><link rel="prefetch" href="/assets/js/73.a4c47c5d.js"><link rel="prefetch" href="/assets/js/74.f15ffae0.js"><link rel="prefetch" href="/assets/js/75.521c0c79.js"><link rel="prefetch" href="/assets/js/76.1b97a910.js"><link rel="prefetch" href="/assets/js/77.e7cb839b.js"><link rel="prefetch" href="/assets/js/78.266de21b.js"><link rel="prefetch" href="/assets/js/79.016a7490.js"><link rel="prefetch" href="/assets/js/80.90f00dcb.js"><link rel="prefetch" href="/assets/js/81.b6445a34.js"><link rel="prefetch" href="/assets/js/82.9637b9d8.js"><link rel="prefetch" href="/assets/js/83.ebde50c0.js"><link rel="prefetch" href="/assets/js/84.5f1ab12c.js"><link rel="prefetch" href="/assets/js/85.0fbb1961.js"><link rel="prefetch" href="/assets/js/86.c969fc3d.js"><link rel="prefetch" href="/assets/js/87.4be0e169.js"><link rel="prefetch" href="/assets/js/88.23a90ed4.js"><link rel="prefetch" href="/assets/js/89.67ada737.js"><link rel="prefetch" href="/assets/js/90.f5d91bf3.js"><link rel="prefetch" href="/assets/js/91.9f1d99ba.js"><link rel="prefetch" href="/assets/js/92.2daceedd.js"><link rel="prefetch" href="/assets/js/93.507dc047.js"><link rel="prefetch" href="/assets/js/94.3b80b80c.js"><link rel="prefetch" href="/assets/js/95.dfaed830.js"><link rel="prefetch" href="/assets/js/96.3a566abf.js"><link rel="prefetch" href="/assets/js/97.ac815764.js"><link rel="prefetch" href="/assets/js/98.440b75b9.js"><link rel="prefetch" href="/assets/js/99.f2dd4615.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.271bc088.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4c261fea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NightWatch</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/Basic/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/front-end/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/front-end/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/front-end/前端工程化/" class="nav-link">
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/front-end/性能优化/" class="nav-link">
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/front-end/数据格式/" class="nav-link">
  数据格式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端开发" class="dropdown-title"><span class="title">后端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端开发" class="mobile-dropdown-title"><span class="title">后端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/environment/" class="nav-link">
  环境配置
</a></li><li class="dropdown-item"><!----> <a href="/back-end/mysql/" class="nav-link">
  MySQL数据库
</a></li><li class="dropdown-item"><!----> <a href="/back-end/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/back-end/springboot/" class="nav-link router-link-active">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/back-end/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/back-end/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer/linux/" class="nav-link">
  Linux操作系统
</a></li><li class="dropdown-item"><!----> <a href="/computer/windows/" class="nav-link">
  Windows操作系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GIS开发" class="dropdown-title"><span class="title">GIS开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="GIS开发" class="mobile-dropdown-title"><span class="title">GIS开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gis/GIS原理/" class="nav-link">
  GIS原理
</a></li><li class="dropdown-item"><!----> <a href="/gis/WebGIS/" class="nav-link">
  WebGIS开发
</a></li><li class="dropdown-item"><!----> <a href="/gis/地图学/" class="nav-link">
  地图学
</a></li><li class="dropdown-item"><!----> <a href="/gis/数据库/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/gis/tools/" class="nav-link">
  GIS工具
</a></li></ul></div></div><div class="nav-item"><a href="/rong/" class="nav-link">
  Rong
</a></div><div class="nav-item"><a href="/others/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/test/1.html" class="nav-link">
  测试
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/Basic/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/front-end/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/front-end/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/front-end/前端工程化/" class="nav-link">
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/front-end/性能优化/" class="nav-link">
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/front-end/数据格式/" class="nav-link">
  数据格式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端开发" class="dropdown-title"><span class="title">后端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端开发" class="mobile-dropdown-title"><span class="title">后端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/environment/" class="nav-link">
  环境配置
</a></li><li class="dropdown-item"><!----> <a href="/back-end/mysql/" class="nav-link">
  MySQL数据库
</a></li><li class="dropdown-item"><!----> <a href="/back-end/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/back-end/springboot/" class="nav-link router-link-active">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/back-end/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/back-end/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer/linux/" class="nav-link">
  Linux操作系统
</a></li><li class="dropdown-item"><!----> <a href="/computer/windows/" class="nav-link">
  Windows操作系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GIS开发" class="dropdown-title"><span class="title">GIS开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="GIS开发" class="mobile-dropdown-title"><span class="title">GIS开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gis/GIS原理/" class="nav-link">
  GIS原理
</a></li><li class="dropdown-item"><!----> <a href="/gis/WebGIS/" class="nav-link">
  WebGIS开发
</a></li><li class="dropdown-item"><!----> <a href="/gis/地图学/" class="nav-link">
  地图学
</a></li><li class="dropdown-item"><!----> <a href="/gis/数据库/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/gis/tools/" class="nav-link">
  GIS工具
</a></li></ul></div></div><div class="nav-item"><a href="/rong/" class="nav-link">
  Rong
</a></div><div class="nav-item"><a href="/others/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/test/1.html" class="nav-link">
  测试
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Springboot</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/back-end/springboot/" aria-current="page" class="sidebar-link">♥SpringBoot家族♥</a></li><li><a href="/back-end/springboot/MyBatis从入门到精通.html" class="sidebar-link">MyBatis从入门到精通</a></li><li><a href="/back-end/springboot/MybatisPlus从入门到精通.html" class="sidebar-link">MyBatisPlus从入门到精通</a></li><li><a href="/back-end/springboot/ShardingSphere分库分表.html" class="active sidebar-link">ShardingSphere分库分表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#shardingsphere简介" class="sidebar-link">ShardingSphere简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#shardingjdbc客户端分库分表" class="sidebar-link">ShardingJDBC客户端分库分表</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#shardingproxy服务端分库分表" class="sidebar-link">ShardingProxy服务端分库分表</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#jdbc和proxy对比" class="sidebar-link">JDBC和Proxy对比</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#分库分表的优势" class="sidebar-link">分库分表的优势</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#分库分表的挑战" class="sidebar-link">分库分表的挑战</a></li></ul></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#版本变更5-3-0" class="sidebar-link">版本变更5.3.0</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#maven坐标" class="sidebar-link">Maven坐标</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#自定义算法" class="sidebar-link">自定义算法</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#事务" class="sidebar-link">事务</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#配置文件" class="sidebar-link">配置文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#分片算法详解-补充" class="sidebar-link">分片算法详解（补充）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#时间范围分片" class="sidebar-link">时间范围分片</a></li></ul></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#使用案例" class="sidebar-link">使用案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#shardingjdbc基于mybatis单库分表" class="sidebar-link">ShardingJDBC基于Mybatis单库分表</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#shardingjdbc基于jpa单库分表" class="sidebar-link">ShardingJDBC基于JPA单库分表</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#shardingjsbd基于jpa读写分离" class="sidebar-link">ShardingJSBD基于jpa读写分离</a></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#shardingjdbc基于jpa的db隔离" class="sidebar-link">ShardingJDBC基于JPA的DB隔离</a></li></ul></li><li class="sidebar-sub-header"><a href="/back-end/springboot/ShardingSphere分库分表.html#参考文档" class="sidebar-link">参考文档</a></li></ul></li><li><a href="/back-end/springboot/SpringBoot参数校验-文档.html" class="sidebar-link">SpringBoot 学习</a></li><li><a href="/back-end/springboot/SpringBoot定时任务.html" class="sidebar-link">SpringBoot定时任务</a></li><li><a href="/back-end/springboot/SpringBoot应用部署.html" class="sidebar-link">SpringBoot应用部署</a></li><li><a href="/back-end/springboot/SpringBoot日志.html" class="sidebar-link">SpringBoot日志</a></li><li><a href="/back-end/springboot/SpringBoot热更新.html" class="sidebar-link">SpringBoot热更新</a></li><li><a href="/back-end/springboot/SpringBoot连接MySQL.html" class="sidebar-link">Springboot 数据库连接</a></li><li><a href="/back-end/springboot/SpringBoot连接Redis.html" class="sidebar-link">SpringBoot连接Redis</a></li><li><a href="/back-end/springboot/SpringBoot集成ElasticSearch.html" class="sidebar-link">SpringBoot集成ElasticSearch</a></li><li><a href="/back-end/springboot/SpringBoot集成Websocket.html" class="sidebar-link">SpringBoot集成Websocket</a></li><li><a href="/back-end/springboot/SpringBoot集成文件.html" class="sidebar-link">SpringBoot集成文件</a></li><li><a href="/back-end/springboot/SpringSecurity从入门到精通.html" class="sidebar-link">SpringSecurity从入门到精通</a></li><li><a href="/back-end/springboot/Springboot连接池.html" class="sidebar-link">Springboot数据库连接池</a></li><li><a href="/back-end/springboot/Springboot配置.html" class="sidebar-link">Springboot环境配置</a></li><li><a href="/back-end/springboot/Spring单元测试.html" class="sidebar-link">Spring单元测试</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="shardingsphere分库分表"><a href="#shardingsphere分库分表" class="header-anchor">#</a> ShardingSphere分库分表</h1> <h2 id="shardingsphere简介"><a href="#shardingsphere简介" class="header-anchor">#</a> ShardingSphere简介</h2> <p>Sharding就是数据分片。他的核心功能就是可以将任意数据库组合，转换成为一个分布式数据库，提供整体的数据库集群服务，本身不做数据存储，而是对其他数据库产品进行整合。</p> <p>Sphere是生态的意思，这意味着ShardingSphere不是一个单独的产品或框架，而是由多个框架以及产品组成的一个完整的技术生态。目前主要的成型产品是<code>ShardingJDBC</code> 和<code>SphereProxy</code>两个产品，以及一个用于数据迁移的子项目ElasticJob、基于公有云的云上服务OnCloud。</p> <p>目前ShardingSphere已经演进到了5.X大版本，它的核心设计哲学是<code>连接、增强、可插拔</code>。</p> <h3 id="shardingjdbc客户端分库分表"><a href="#shardingjdbc客户端分库分表" class="header-anchor">#</a> ShardingJDBC客户端分库分表</h3> <p>定位为轻量级Java框架，在Java的JDBC层提供额外服务，使用客户端直连数据库，以jar包形式提供服务，完全兼容JDBC和各种ORM框架。</p> <ul><li>适用于任何基于JDBC的ORM框架：JPA、Hibernate、Mybatis、Spring JDBC Template</li> <li>支持任何第三方的数据库连接池：DBCP、C3P0、HikariCP等</li> <li>支持任意实现JDBC规范的数据库：目前支持MySQL、PostgreSQL、Oracle、SQLserver等</li></ul> <h3 id="shardingproxy服务端分库分表"><a href="#shardingproxy服务端分库分表" class="header-anchor">#</a> ShardingProxy服务端分库分表</h3> <p>定位为透明化的数据库代理端，通过实现数据库二进制协议，对异构语言提供支持。</p> <ul><li>对应用程序完全透明，可以直接当做MySQL/PostgreSQL使用</li> <li>兼容MariaDB等基于MySQL协议的数据库，以及openGauss等基于Postgresql协议的数据库</li> <li>适用于任何兼容MySQL/Postgresql协议的客户端，如:Mysql Command Client，MySQL Workbench、Navicat等。</li></ul> <h3 id="jdbc和proxy对比"><a href="#jdbc和proxy对比" class="header-anchor">#</a> JDBC和Proxy对比</h3> <table><thead><tr><th></th> <th>ShardingSphere-JDBC</th> <th>ShardingSphere-Proxy</th></tr></thead> <tbody><tr><td>数据库</td> <td>任意</td> <td>MySQL/PostgreSQL</td></tr> <tr><td>连接消耗数</td> <td>高</td> <td>低</td></tr> <tr><td>异构语言</td> <td>仅Java</td> <td>任意</td></tr> <tr><td>性能</td> <td>损耗低</td> <td>损耗略高</td></tr> <tr><td>无中心化</td> <td>是</td> <td>否</td></tr> <tr><td>静态入口</td> <td>无</td> <td>有</td></tr></tbody></table> <h3 id="分库分表的优势"><a href="#分库分表的优势" class="header-anchor">#</a> 分库分表的优势</h3> <p>提高系统性能：将大型数据库分成多个小数据库，每个小数据库只需要处理部分数据</p> <p>提高系统可用性：可以将数据复制到多个数据库</p> <p>提高系统课扩展性：当数据量增加，只需要增加更多的数据库和表，而不是替换整个数据库</p> <p>提高系统灵活性：可以根据数据的使用情况，对不同的数据库和表进行不同的优化</p> <p>降低系统成本：分库分表可以使用更便宜的硬件和存储设备</p> <h3 id="分库分表的挑战"><a href="#分库分表的挑战" class="header-anchor">#</a> 分库分表的挑战</h3> <p>数据是应用的基础，随着数据被拆分到多个分片，应用层会面临很多新的问题。</p> <ul><li><strong>主键避重问题</strong>：自增ID无法保证全局唯一，需要单独设计全局主键</li> <li><strong>数据备份问题</strong>：如何保持集群服务整体的稳定性</li> <li><strong>数据迁移问题</strong>：业务增长必然遇到的问题，当数据库集群需要扩缩容的时候，数据也要跟着迁移</li> <li><strong>分布式事务问题</strong>：数据分布在不同的库和服务器，不可避免会带来分布式事务问题</li> <li><strong>SQL路由问题</strong>：执行SQL语句检索的时候，如何快速定位到目标数据所在的数据库</li> <li><strong>跨节点查询、归并问题</strong>：比如常见的Limit、OrderBy等等</li></ul> <blockquote><p>业界目前唯一比较值得参考的详细标准，是阿里公开的开发手册中提到的诶，<strong>建议预估三年内，单表数据超过500W，或者单表数据大小超过2G</strong>，就需要考虑分库分表。</p></blockquote> <h2 id="版本变更5-3-0"><a href="#版本变更5-3-0" class="header-anchor">#</a> 版本变更5.3.0</h2> <h3 id="maven坐标"><a href="#maven坐标" class="header-anchor">#</a> Maven坐标</h3> <p>ShardingSphere 5.3.0 以前,可以直接在yml文件中配置</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shardingsphere-jdbc-core-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${shardingsphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shardingsphere-jdbc-core-spring-namespace<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${shardingsphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ShardingSphere 5.3.0 以后</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shardingsphere-jdbc-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${shardingsphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在 5.3.0 版本以前，ShardingSphere-JDBC 同时支持 Java API、YAML、Spring Boot Starter 和 Spring Namespace 等配置方式,维护更新较为困难。</p> <p>pom.xml示例</p> <div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.7.18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--解决版本冲突问题--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.yaml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>snakeyaml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--需要手动引入 解析yaml文件--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.yaml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>snakeyaml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.7.18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--sharding 核心库--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shardingsphere-jdbc-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.4.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="自定义算法"><a href="#自定义算法" class="header-anchor">#</a> 自定义算法</h3> <p>移除 Spring 模块会同时移除 AlgorithmProvided 相关类。若此前用户在自定义算法中有使用到 Bean 注入相关的逻辑，更新后将失效。对需要在算法中使用 Spring Bean 的场景，需开发者主动管理。</p> <h3 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h3> <p>移除用于支持方法级别事务声明的 @ShardingSphereTransactionType 注解。</p> <p>若用户有在方法级别更改事务类型的需求，请使用Java API方式。</p> <h3 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h3> <p>ShardingSphere 社区决定在 ShardingSphere 5.3.0 Release 中<strong>移除 Spring 全部依赖和配置支持</strong>!!!</p> <p>使用方式为在application.yml文件引入官方的sharding.yaml配置文件（resources目录下）</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> org.apache.shardingsphere.driver.ShardingSphereDriver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>shardingsphere<span class="token punctuation">:</span>classpath<span class="token punctuation">:</span>sharding.yaml
</code></pre></div><p>所以建议直接学习一下官方的yaml配置文件书写格式</p> <p><a href="https://shardingsphere.apache.org/document/5.5.1/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/" target="_blank" rel="noopener noreferrer">Sharding5.5.1文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>sharding.yaml示例</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># 数据源配置</span>
<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">m0</span><span class="token punctuation">:</span>
    <span class="token key atrule">dataSourceClassName</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">jdbcUrl</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/coursedb1<span class="token punctuation">?</span>serverTimezone=UTC
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
  <span class="token key atrule">m1</span><span class="token punctuation">:</span>
    <span class="token key atrule">dataSourceClassName</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">jdbcUrl</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/coursedb2<span class="token punctuation">?</span>serverTimezone=UTC
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>

<span class="token comment"># 分片规则配置</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">course</span><span class="token punctuation">:</span> <span class="token comment"># 要分片的表</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> m$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.course_$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>1..2<span class="token punctuation">}</span> <span class="token comment"># 实际数据节点</span>
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 表分片策略</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span> <span class="token comment"># 标准分片策略，</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> cid
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> course_tbl_alg
      <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 数据库分片策略</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span> <span class="token comment"># 用于单分片键的标准分片场景</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> cid <span class="token comment"># 分片列名称</span>
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> course_db_alg <span class="token comment"># 分片算法名称</span>
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 主键生成策略</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> cid
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> alg_snowflake

  <span class="token comment"># 表默认不分片</span>
  <span class="token key atrule">defaultTableStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">none</span><span class="token punctuation">:</span>
  <span class="token comment"># 默认数据库不分片</span>
  <span class="token key atrule">defaultDatabaseStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">none</span><span class="token punctuation">:</span>

  <span class="token comment"># 分片算法</span>
  <span class="token key atrule">shardingAlgorithms</span><span class="token punctuation">:</span>
    <span class="token key atrule">course_db_alg</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> m$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>cid%2<span class="token punctuation">}</span> <span class="token comment"># 分片数量</span>
    <span class="token key atrule">course_db_alg1</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> MOD
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">sharding-count</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># 分片数量</span>
    <span class="token key atrule">course_tbl_alg</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> course_$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>cid%2+1<span class="token punctuation">}</span> <span class="token comment"># 算法的行表达式</span>

  <span class="token comment"># 分布式序列算法配置</span>
  <span class="token key atrule">keyGenerators</span><span class="token punctuation">:</span>
    <span class="token key atrule">alg_snowflake</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">worker-id</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">props</span><span class="token punctuation">:</span>
  <span class="token key atrule">sql-show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h2 id="分片算法详解-补充"><a href="#分片算法详解-补充" class="header-anchor">#</a> 分片算法详解（补充）</h2> <h3 id="时间范围分片"><a href="#时间范围分片" class="header-anchor">#</a> 时间范围分片</h3> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># 开发环境分库分表</span>

<span class="token comment"># 数据源配置</span>
<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">m0</span><span class="token punctuation">:</span>
    <span class="token key atrule">dataSourceClassName</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">jdbcUrl</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/hzw_bridge<span class="token punctuation">?</span>useSSL=false<span class="token important">&amp;serverTimezone=Asia/Shanghai</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> 
  <span class="token key atrule">m1</span><span class="token punctuation">:</span>
    <span class="token key atrule">dataSourceClassName</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">jdbcUrl</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/hzw_bridge_ais<span class="token punctuation">?</span>useSSL=false<span class="token important">&amp;serverTimezone=Asia/Shanghai</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> 

<span class="token comment"># 分片规则配置</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token comment"># 加载单表</span>
<span class="token punctuation">-</span> <span class="token tag">!SINGLE</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token comment"># MySQL 风格</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;*.*&quot;</span> <span class="token comment"># 所有表都不需要分片</span>
<span class="token comment"># 要分片的表</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">ais_move</span><span class="token punctuation">:</span> <span class="token comment"># 要分片的表</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> m1.ais_move_$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>202501..203012<span class="token punctuation">}</span> <span class="token comment"># 实际数据节点</span>
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 表分片策略</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span> <span class="token comment"># 标准分片策略，</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> update_time
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> ais_sharding_alg
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 主键生成策略</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> id
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> alg_snowflake

  <span class="token comment"># 默认数据库不分片</span>
  <span class="token key atrule">defaultDatabaseStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">none</span><span class="token punctuation">:</span>

  <span class="token comment"># 表默认不分片</span>
  <span class="token key atrule">defaultTableStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">none</span><span class="token punctuation">:</span>

  <span class="token comment"># 分片算法</span>
  <span class="token key atrule">shardingAlgorithms</span><span class="token punctuation">:</span>
    <span class="token key atrule">ais_sharding_alg</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INTERVAL
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">datetime-pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span> <span class="token comment"># 时间格式</span>
        <span class="token key atrule">datetime-lower</span><span class="token punctuation">:</span> <span class="token string">&quot;2025-01-01 00:00:00&quot;</span> <span class="token comment"># 时间分片下限</span>
        <span class="token key atrule">datetime-upper</span><span class="token punctuation">:</span> <span class="token string">&quot;2030-12-31 23:59:59&quot;</span> <span class="token comment"># 时间分片上限</span>
        <span class="token key atrule">sharding-suffix-pattern</span><span class="token punctuation">:</span> yyyyMM <span class="token comment"># 表后缀名</span>
        <span class="token key atrule">datetime-interval-unit</span><span class="token punctuation">:</span> MONTHS <span class="token comment"># 时间片段单位</span>
        <span class="token key atrule">datetime-interval-amount</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 时间片段数量</span>

  <span class="token comment"># 分布式序列算法配置</span>
  <span class="token key atrule">keyGenerators</span><span class="token punctuation">:</span>
    <span class="token key atrule">alg_snowflake</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">worker-id</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">props</span><span class="token punctuation">:</span>
  <span class="token key atrule">sql-show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h2 id="使用案例"><a href="#使用案例" class="header-anchor">#</a> 使用案例</h2> <h3 id="shardingjdbc基于mybatis单库分表"><a href="#shardingjdbc基于mybatis单库分表" class="header-anchor">#</a> ShardingJDBC基于Mybatis单库分表</h3> <h4 id="引入依赖"><a href="#引入依赖" class="header-anchor">#</a> 引入依赖</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.pagehelper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>pagehelper-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="yml配置"><a href="#yml配置" class="header-anchor">#</a> yml配置</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> ds  <span class="token comment"># 数据源名称，唯一标识</span>
      <span class="token key atrule">ds</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource  <span class="token comment"># 数据源类型</span>
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver <span class="token comment"># 驱动名称</span>
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_sharding<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">tb_user</span><span class="token punctuation">:</span>  <span class="token comment"># 要分库分表的名称</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> ds.tb_user_$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>0..1<span class="token punctuation">}</span> <span class="token comment"># 数据节点 tb_user_0 tb_user_1</span>
          <span class="token key atrule">table-strategy</span><span class="token punctuation">:</span> <span class="token comment"># 分表策略</span>
            <span class="token key atrule">inline</span><span class="token punctuation">:</span> <span class="token comment"># 内联方式</span>
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id <span class="token comment"># 切片的列</span>
              <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> tb_user_$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>id % 2<span class="token punctuation">}</span> <span class="token comment"># 奇数在tb_user_1 偶数在tb_user_0</span>
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span> <span class="token comment"># 主键生成策略</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id <span class="token comment"># 主键列名</span>
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span> <span class="token comment"># 工作节点为123</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
      <span class="token key atrule">binding-tables</span><span class="token punctuation">:</span> tb_user
      
  <span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
    <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> <span class="token comment">#实体对象包全限定名</span>
    <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
      <span class="token key atrule">cache-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">use-generated-keys</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">default-executor-type</span><span class="token punctuation">:</span> REUSE
      <span class="token key atrule">use-actual-param-name</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h4 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h4> <ol><li>数据分片后，原有的数据库自动增长ID以及ORM层框架的配置不能再使用</li> <li>使用SNOWFLAKE 雪花算法，64为LONG类型，所以需要设置相关字段为BIGINT</li> <li>注意项目中springboot、jdk的版本号</li></ol> <h3 id="shardingjdbc基于jpa单库分表"><a href="#shardingjdbc基于jpa单库分表" class="header-anchor">#</a> ShardingJDBC基于JPA单库分表</h3> <h4 id="引入依赖-2"><a href="#引入依赖-2" class="header-anchor">#</a> 引入依赖</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.wenhao<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jpa-spec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="yml配置-2"><a href="#yml配置-2" class="header-anchor">#</a> yml配置</h4> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># sharding部分配置和前文mybatis方式相同</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">open-in-view</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 每个请求处理完毕关闭数据库连接</span>
    <span class="token key atrule">generate-ddl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 一般在开发阶段使用，根据entity生成数据库的ddl</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 控制台不显示sql语句</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span> 
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">dialect</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQLDialect  <span class="token comment"># 数据库方言</span>
        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> 
        <span class="token key atrule">use-new-id-generator-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 新的主键映射策略</span>
</code></pre></div><h4 id="注意事项-2"><a href="#注意事项-2" class="header-anchor">#</a> 注意事项</h4> <ol><li>jpa方式要使用@Table标注表名  @Repository标注dao</li></ol> <h3 id="shardingjsbd基于jpa读写分离"><a href="#shardingjsbd基于jpa读写分离" class="header-anchor">#</a> ShardingJSBD基于jpa读写分离</h3> <h4 id="读写分离介绍"><a href="#读写分离介绍" class="header-anchor">#</a> 读写分离介绍</h4> <p>设计目标：让使用方像使用一个数据库一样使用主从数据库集群</p> <p>读写分离则是根据SQL语义的分析，将读操作和写操作分别路由至主库与从库。</p> <p>读写分离可以提升系统的吞吐量和可用性，但也带来了数据不一致的问题</p> <h4 id="引入依赖-3"><a href="#引入依赖-3" class="header-anchor">#</a> 引入依赖</h4> <div class="language-xml extra-class"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.wenhao<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jpa-spec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="yml配置-3"><a href="#yml配置-3" class="header-anchor">#</a> yml配置</h4> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> master<span class="token punctuation">,</span>slave0 <span class="token comment"># 定义多个数据源</span>
      <span class="token key atrule">master</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_sharding_master<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> test
        <span class="token key atrule">password</span><span class="token punctuation">:</span> test
      <span class="token key atrule">slave0</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_sharding_slave0<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> test
        <span class="token key atrule">password</span><span class="token punctuation">:</span> test
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>  <span class="token comment"># 分片</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">tb_user</span><span class="token punctuation">:</span>
          <span class="token key atrule">database-strategy</span><span class="token punctuation">:</span>
            <span class="token key atrule">inline</span><span class="token punctuation">:</span>
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id
              <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> master
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> id
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
            <span class="token key atrule">props</span><span class="token punctuation">:</span>
              <span class="token key atrule">worker</span><span class="token punctuation">:</span>
                <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">123</span>
 		<span class="token comment"># 其他表</span>
    <span class="token key atrule">master-slave</span><span class="token punctuation">:</span> <span class="token comment">#主从配置</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> ms
        <span class="token key atrule">load-balance-algorithm-type</span><span class="token punctuation">:</span> round_robin  <span class="token comment"># 负载均衡算法为轮询</span>
        <span class="token key atrule">master-data-source-name</span><span class="token punctuation">:</span> master <span class="token comment"># 主数据库名称</span>
        <span class="token key atrule">slave-data-source-names</span><span class="token punctuation">:</span> slave0 <span class="token comment"># 从数据库名称</span>
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">open-in-view</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">generate-ddl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">dialect</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQLDialect
        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">use-new-id-generator-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div><h4 id="注意事项-3"><a href="#注意事项-3" class="header-anchor">#</a> 注意事项</h4> <ol><li>主库和从库的数据同步不是shardingJDBC做的，需要自行同步</li> <li>查询操作会发生在从库，修改、添加，操作会发生在主库</li></ol> <p>原文链接  https://www.pdai.tech/md/spring/springboot/springboot-x-mysql-shardingjdbc-jpa-masterslave.html</p> <h3 id="shardingjdbc基于jpa的db隔离"><a href="#shardingjdbc基于jpa的db隔离" class="header-anchor">#</a> ShardingJDBC基于JPA的DB隔离</h3> <h4 id="知识准备"><a href="#知识准备" class="header-anchor">#</a> 知识准备</h4> <ol><li><p>逻辑表：水平拆分的数据库的相同逻辑和数据结构表的<strong>总称</strong>。例如订单数据有10张表，分别是t_order_0到t_order_9，逻辑表名为t_order</p></li> <li><p>真实表：分片数据库中真实存在的物理表，t_order_0到t_order_9</p></li> <li><p>数据节点： 数据源名称和数据表，例如ds_0.t_order_0</p></li> <li><p>绑定表：<strong>分片规则一致</strong>的主表和子表，如t_order和t_order_item，均按照order_id分片</p> <ul><li>绑定表之间的多表关联查询不会出现笛卡尔积</li></ul></li> <li><p>广播表： 分布式计算中，将小表的副本发送到集群的每个节点，以便提高访问效率。</p></li> <li><p>分片键：用于分片的数据库字段</p></li> <li><p>分片算法：精确分片算法（单字段）、范围分片算法、复合分片算法（多字段）、Hint分片算法</p></li> <li><p>分片策略：标准分片策略、复合分片策略、行表达式分片策略（groovy表达式）、Hint分片策略</p></li></ol> <h4 id="yml配置-4"><a href="#yml配置-4" class="header-anchor">#</a> yml配置</h4> <div class="language-yml extra-class"><pre class="language-yml"><code>  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>a<span class="token punctuation">,</span>tenant<span class="token punctuation">-</span>b
      <span class="token key atrule">tenant-a</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_db_tenant_a<span class="token punctuation">?</span>allowPublicKeyRetrieval=true<span class="token important">&amp;useSSL=false&amp;autoReconnect=true&amp;characterEncoding=utf8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
      <span class="token key atrule">tenant-b</span><span class="token punctuation">:</span>
			<span class="token punctuation">...</span>
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token key atrule">default-database-strategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">hint</span><span class="token punctuation">:</span>
          <span class="token key atrule">algorithm-class-name</span><span class="token punctuation">:</span> 
          	<span class="token comment"># hint算法全限定类名</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">tb_user</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
			<span class="token punctuation">...</span>
        <span class="token key atrule">tb_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
			<span class="token punctuation">...</span>
        <span class="token key atrule">tb_user_role</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> tenant<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>.tb_user_role
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
			<span class="token punctuation">...</span>
      <span class="token key atrule">binding-tables</span><span class="token punctuation">:</span> tb_user<span class="token punctuation">,</span>tb_role<span class="token punctuation">,</span>tb_user_role
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h4 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TenantDatasourceAspect</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 定义切点.
     */</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* tech.pdai.springboot.shardingjdbc.jpa.tenant.dbhint.dao.*.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">useTenantDSPointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// no impl</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 前置逻辑</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;useTenantDSPointCut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doDs0Before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HintManager</span> hintManager <span class="token operator">=</span> <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 实际环境将client信息放在xxxContext中（由ThreadLocal承接），并通过client-id来获取tenant.</span>
        <span class="token comment">// 这里为了方便演示，只是使用了tenant-a</span>
        hintManager<span class="token punctuation">.</span><span class="token function">setDatabaseShardingValue</span><span class="token punctuation">(</span><span class="token string">&quot;tenant-a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 后置逻辑</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;useTenantDSPointCut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doDs0after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <p><a href="https://www.cnblogs.com/chengxy-nds/p/18097298" target="_blank" rel="noopener noreferrer">分片算法详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/11/2025, 8:52:58 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/back-end/springboot/MybatisPlus从入门到精通.html" class="prev">
        MyBatisPlus从入门到精通
      </a></span> <span class="next"><a href="/back-end/springboot/SpringBoot参数校验-文档.html">
        SpringBoot 学习
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1522ec5c.js" defer></script><script src="/assets/js/2.4829a41e.js" defer></script><script src="/assets/js/1.21e39df5.js" defer></script><script src="/assets/js/57.7d9e50ac.js" defer></script>
  </body>
</html>
